generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id         Int         @id @default(autoincrement())
  email      String      @unique
  username   String      @unique
  password   String
  createdAt  DateTime    @default(now())
  posts      Post[]      @relation("UserPosts")
  replies    Reply[]     @relation("UserReplies")
  postVotes  PostVote[]  @relation("UserPostVotes")
  replyVotes ReplyVote[] @relation("UserReplyVotes")
}

model Post {
  id        Int        @id @default(autoincrement())
  title     String
  content   String
  authorId  Int
  author    User       @relation("UserPosts", fields: [authorId], references: [id])
  createdAt DateTime   @default(now())
  replies   Reply[]
  votes     PostVote[] @relation("PostVotes")
  media     Media[]
}

model Reply {
  id        Int         @id @default(autoincrement())
  content   String
  createdAt DateTime    @default(now())
  postId    Int
  post      Post        @relation(fields: [postId], references: [id])
  authorId  Int
  author    User        @relation("UserReplies", fields: [authorId], references: [id])
  parentId  Int?
  parent    Reply?      @relation("ReplyToReply", fields: [parentId], references: [id])
  replies   Reply[]     @relation("ReplyToReply")
  votes     ReplyVote[] @relation("ReplyVotes")
}

model PostVote {
  userId Int
  postId Int
  value  Int
  user   User @relation("UserPostVotes", fields: [userId], references: [id])
  post   Post @relation("PostVotes", fields: [postId], references: [id])

  @@id([userId, postId])
}

model Media {
  id        Int     @id @default(autoincrement())
  postId    Int
  post      Post    @relation(fields: [postId], references: [id], onDelete: Cascade)
  filename  String
  mimetype  String
  filepath  String
  createdAt DateTime @default(now())
}

model ReplyVote {
  userId  Int
  replyId Int
  value   Int
  user    User  @relation("UserReplyVotes", fields: [userId], references: [id])
  reply   Reply @relation("ReplyVotes", fields: [replyId], references: [id])

  @@id([userId, replyId])
}